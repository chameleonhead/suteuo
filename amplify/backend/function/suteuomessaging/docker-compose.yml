version: "3.5"

services:
  dynamodb:
    image: amazon/dynamodb-local
    command: -jar DynamoDBLocal.jar -dbPath ./data -sharedDb
    volumes:
      - ./dynamodb-local:/home/dynamodblocal/data
    ports:
      - 8000:8000
  dynamodb-admin:
    image: aaronshaf/dynamodb-admin
    environment:
      - AWS_ACCESS_KEY_ID=fakeAccessKeyId
      - AWS_SECRET_ACCESS_KEY=fakeSecretAccessKey
      - AWS_REGION=us-west-2
      - DYNAMO_ENDPOINT=dynamodb:8000
    ports:
      - 8001:8001
    depends_on:
      - dynamodb
  node:
    image: node:12
    command: bash -c 'npm install && npm run start'
    working_dir: /app
    volumes:
      - ./src:/app
    ports:
      - 4000:3000
    environment:
      - STORAGE_SUTEUOMESSAGING_NAME=suteuomessaging
      - ENDPOINT_OVERRIDE=http://dynamodb:8000
  swagger-ui:
    image: swaggerapi/swagger-ui
    ports:
      - 4001:8080
    environment:
      - API_URL=http://localhost:4000/api-docs.json
  aws-cli:
    image: amazon/aws-cli:2.0.56
    entrypoint: /dynamodb-init.sh
    environment:
      - AWS_ACCESS_KEY_ID=fakeAccessKeyId
      - AWS_SECRET_ACCESS_KEY=fakeSecretAccessKey
      - DYNAMODB_REGION=us-west-2
    volumes:
      - ./dynamodb-init.sh:/dynamodb-init.sh
    depends_on:
      - dynamodb
